<!DOCTYPE html>
<html>
<head>
    <title>J5 Pharmacy PMS - Backend Support</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <style>
        :root {
            --bg-color: #ffffff;
            --text-color: #333333;
            --header-bg: #f8f9fa;
            --card-bg: #ffffff;
            --border-color: #dee2e6;
        }

        [data-theme="dark"] {
            --bg-color: #1a1a1a;
            --text-color: #ffffff;
            --header-bg: #2d2d2d;
            --card-bg: #333333;
            --border-color: #404040;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: background-color 0.3s, color 0.3s;
        }

        .header {
            background-color: var(--header-bg);
            padding: 15px 20px;
            border-bottom: 1px solid var(--border-color);
            transition: background-color 0.3s;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .title-section {
            flex-grow: 1;
        }

        .title {
            margin: 0;
            font-size: 24px;
            color: var(--text-color);
        }

        .subtitle {
            margin: 5px 0 0 0;
            font-size: 14px;
            color: var(--text-color);
            opacity: 0.8;
        }

        .controls-section {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .datetime {
            text-align: right;
            font-size: 14px;
            color: var(--text-color);
        }

        .theme-toggle {
            background: none;
            border: none;
            cursor: pointer;
            padding: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            transition: background-color 0.3s;
        }

        .theme-toggle:hover {
            background-color: rgba(128, 128, 128, 0.1);
        }

        .theme-toggle svg {
            width: 24px;
            height: 24px;
            fill: var(--text-color);
        }

        /* Rest of your existing styles... */
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <div class="title-section">
                <h1 class="title">J5 Pharmacy Management System - Backend Support</h1>
                <p class="subtitle">Control panel for managing the J5 Pharmacy Management System backend server and system monitoring.</p>
            </div>
            <div class="controls-section">
                <div class="datetime">
                    <div id="time"></div>
                    <div id="date"></div>
                </div>
                <button class="theme-toggle" id="themeToggle" title="Toggle theme">
                    <svg class="sun-icon" viewBox="0 0 24 24">
                        <path d="M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zM2 13h2c.55 0 1-.45 1-1s-.45-1-1-1H2c-.55 0-1 .45-1 1s.45 1 1 1zm18 0h2c.55 0 1-.45 1-1s-.45-1-1-1h-2c-.55 0-1 .45-1 1s.45 1 1 1zM11 2v2c0 .55.45 1 1 1s1-.45 1-1V2c0-.55-.45-1-1-1s-1 .45-1 1zm0 18v2c0 .55.45 1 1 1s1-.45 1-1v-2c0-.55-.45-1-1-1s-1 .45-1 1zM5.99 4.58c-.39-.39-1.03-.39-1.41 0-.39.39-.39 1.03 0 1.41l1.06 1.06c.39.39 1.03.39 1.41 0s.39-1.03 0-1.41L5.99 4.58zm12.37 12.37c-.39-.39-1.03-.39-1.41 0-.39.39-.39 1.03 0 1.41l1.06 1.06c.39.39 1.03.39 1.41 0 .39-.39.39-1.03 0-1.41l-1.06-1.06zm1.06-10.96c.39-.39.39-1.03 0-1.41-.39-.39-1.03-.39-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0l1.06-1.06zM7.05 18.36c.39-.39.39-1.03 0-1.41-.39-.39-1.03-.39-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0l1.06-1.06z"/>
                    </svg>
                    <svg class="moon-icon" viewBox="0 0 24 24" style="display: none;">
                        <path d="M12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9 9-4.03 9-9c0-.46-.04-.92-.1-1.36-.98 1.37-2.58 2.26-4.4 2.26-3.03 0-5.5-2.47-5.5-5.5 0-1.82.89-3.42 2.26-4.4-.44-.06-.9-.1-1.36-.1z"/>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <div class="main-content">
        <div class="log-section">
            <div class="utility-buttons">
                <button id="openLogs" class="utility-btn">
                    <i class="fas fa-folder-open"></i> Open Logs Folder
                </button>
                <button id="checkNetwork" class="utility-btn">
                    <i class="fas fa-network-wired"></i> Check Network
                </button>
                <button id="saveSystemLogs" class="utility-btn">
                    <i class="fas fa-save"></i> Save System Logs
                </button>
            </div>
            <pre id="log"></pre>
        </div>

        <div class="control-section">
            <div class="status-card">
                <div id="serverStatus" class="status-text">Server is stopped</div>
                <div id="networkStatus" class="network-status">Checking network...</div>
                <div id="updateStatus" class="update-status"></div>
            </div>

            <div class="button-group">
                <button id="startServer" class="start-btn">
                    <i class="fas fa-play"></i> Start Server
                </button>
                <button id="stopServer" class="stop-btn">
                    <i class="fas fa-stop"></i> Stop Server
                </button>
                <button id="restartServer" class="restart-btn">
                    <i class="fas fa-sync"></i> Restart Server
                </button>
                <button id="checkUpdate" class="update-btn">
                    <i class="fas fa-download"></i> Check for Updates
                </button>
                <button id="openBrowser" class="browser-btn">
                    <i class="fas fa-external-link-alt"></i> Open Browser
                </button>
                <button id="reportProblem" class="report-btn">
                    <i class="fas fa-bug"></i> Report Problem
                </button>
            </div>

            <div class="logo-container">
                <img src="icons/icon.png" alt="J5 Pharmacy Logo">
                <div class="logo-text">J5 Pharmacy Management System</div>
            </div>
        </div>
    </div>
    
    <!-- Instructions Modal -->
    <div id="instructionsModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <div class="modal-header">
                <h2 class="modal-title">Instructions</h2>
            </div>
            <div class="modal-body">
                <h3>Getting Started</h3>
                <ol>
                    <li>Click "Start Server" to initialize the backend server</li>
                    <li>Wait for the server status to show "Server is running"</li>
                    <li>Click "Open Browser" to access the PMS web interface</li>
                </ol>

                <h3>Server Controls</h3>
                <ul>
                    <li><strong>Start Server:</strong> Initializes the backend server</li>
                    <li><strong>Stop Server:</strong> Shuts down the server safely</li>
                    <li><strong>Restart Server:</strong> Stops and restarts the server</li>
                    <li><strong>Check for Updates:</strong> Checks for system updates</li>
                </ul>

                <h3>Troubleshooting</h3>
                <ul>
                    <li>Check the log window for error messages</li>
                    <li>Ensure all required services are running</li>
                    <li>Verify network connectivity using the "Check Network" button</li>
                    <li>In case of errors, use the "Save System Logs" button to generate a log file and contact the development team with the file attached</li>
                    <li>Error logs are automatically generated and saved in the application's data directory when crashes occur</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- About Modal -->
    <div id="aboutModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="document.getElementById('aboutModal').style.display='none'">&times;</span>
            <div class="modal-header">
                <h2 class="modal-title">About J5 Pharmacy PMS</h2>
            </div>
            <div class="modal-body">
                <p><strong>Version:</strong> <span id="aboutVersion"></span></p>
                <p>J5 Pharmacy Management System is a comprehensive solution for managing pharmacy operations efficiently.</p>
                <p>This backend support application helps you manage the server and monitor system performance.</p>
                <p><strong>Features:</strong></p>
                <ul>
                    <li>Server management and monitoring</li>
                    <li>Automatic updates</li>
                    <li>System diagnostics</li>
                    <li>Error logging and reporting</li>
                </ul>
                <p><strong>&copy; 2025 Zen Garden</strong></p>
            </div>
        </div>
    </div>

    <!-- Developers Modal -->
    <div id="developersModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <div class="modal-header">
                <h2 class="modal-title">Zen Garden Team</h2>
            </div>
            <div class="modal-body">
                <div class="developer-cards">
                    <div class="developer-card">
                        <h3>Project Manager</h3>
                        <p>Kevin Llanes</p>
                        <p>kevsllanes@gmail.com</p>
                    </div>
                    <div class="developer-card">
                        <h3>System Analyst</h3>
                        <p>Bea Alyssa Lugtu</p>
                        <p>lugtubealyssa@gmail.com</p>
                    </div>
                    <div class="developer-card">
                        <h3>Backend Developer</h3>
                        <p>Karl Mathew Miranda</p>
                        <p>@gmail.com</p>
                    </div>
                    <div class="developer-card">
                        <h3>Backend Developer</h3>
                        <p>James Ivan Camique</p>
                        <p>@gmail.com</p>
                    </div>
                    <div class="developer-card">
                        <h3>Business Analyst</h3>
                        <p>@gmail.com</p>
                        <p></p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Report Problem Modal -->
    <div id="reportModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <div class="modal-header">
                <h2 class="modal-title">Report a Problem</h2>
            </div>
            <div class="modal-body">
                <form id="reportForm" class="report-form">
                    <div class="form-group">
                        <label for="problemCategory">Problem Category</label>
                        <select id="problemCategory" required>
                            <option value="">Select a category</option>
                            <option value="server">Server Issues</option>
                            <option value="database">Database Connection</option>
                            <option value="performance">Performance Issues</option>
                            <option value="ui">User Interface Issues</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="problemTitle">Brief Description</label>
                        <input type="text" id="problemTitle" placeholder="Enter a brief title for the issue" required>
                    </div>
                    <div class="form-group">
                        <label for="problemDescription">Detailed Description</label>
                        <textarea id="problemDescription" placeholder="Please describe what happened and steps to reproduce the issue" required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="imageAttachment">Attach Screenshots (optional)</label>
                        <input type="file" id="imageAttachment" accept="image/*" multiple>
                        <div id="imagePreview" class="image-preview"></div>
                    </div>
                    <button type="submit" class="submit-report">
                        <i class="fas fa-paper-plane"></i> Submit Report
                    </button>
                </form>
            </div>
    </div>
    </div>

    <!-- Update Modal -->
    <div id="updateModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <div class="modal-header">
                <h2 class="modal-title">Software Update</h2>
            </div>
            <div class="modal-body">
                <div id="updateInfo">
                    <h3 id="updateTitle"></h3>
                    <p id="updateDescription"></p>
                    <div id="updateDetails">
                        <p><strong>Release Date:</strong> <span id="releaseDate"></span></p>
                        <p><strong>Version:</strong> <span id="updateVersion"></span></p>
                        <div id="releaseNotes" style="margin-top: 15px;">
                            <h4>Release Notes:</h4>
                            <pre style="background: #f5f5f5; padding: 10px; border-radius: 4px;"></pre>
                        </div>
                    </div>
                </div>
                <div id="updateProgress" style="display: none;">
                    <div class="progress-bar-container" style="margin: 20px 0;">
                        <div class="progress-bar" style="width: 0%"></div>
                    </div>
                    <p id="progressText" style="text-align: center;">Downloading: 0%</p>
                </div>
                <div id="updateError" class="error-message" style="display: none;"></div>
            </div>
            <div class="modal-footer" style="margin-top: 20px; text-align: right;">
                <button id="postponeUpdate" class="secondary-btn">Postpone</button>
                <button id="downloadUpdate" class="primary-btn">Download & Install</button>
            </div>
        </div>
    </div>

    <script>
        const { ipcRenderer } = require('electron');
        const log = document.getElementById('log');
        const serverStatus = document.getElementById('serverStatus');
        const networkStatus = document.getElementById('networkStatus');
        const updateStatus = document.getElementById('updateStatus');
        const stopServerBtn = document.getElementById('stopServer');
        const restartServerBtn = document.getElementById('restartServer');
        const openBrowserBtn = document.getElementById('openBrowser');

        // Initially disable stop, restart, and browser buttons
        stopServerBtn.disabled = true;
        restartServerBtn.disabled = true;
        openBrowserBtn.disabled = true;

        // Add disabled button styles
        const styleSheet = document.styleSheets[1]; // Get the main stylesheet
        styleSheet.insertRule(`
            button:disabled {
                opacity: 0.5;
                cursor: not-allowed;
                filter: grayscale(100%);
            }
        `, styleSheet.cssRules.length);

        function appendLog(message) {
            const timestamp = new Date().toLocaleTimeString();
            log.textContent += `[${timestamp}] ${message}\n`;
            log.scrollTop = log.scrollHeight;
        }

        // Server controls
        document.getElementById('startServer').addEventListener('click', () => {
            appendLog('Starting server...');
            ipcRenderer.send('server:start');
        });

        stopServerBtn.addEventListener('click', () => {
            appendLog('Stopping server...');
            ipcRenderer.send('server:stop');
        });

        restartServerBtn.addEventListener('click', () => {
            appendLog('Restarting server...');
            ipcRenderer.send('server:restart');
        });

        document.getElementById('checkUpdate').addEventListener('click', () => {
            appendLog('Checking for updates...');
            ipcRenderer.send('check:update');
        });

        document.getElementById('openBrowser').addEventListener('click', () => {
            if (!serverRunning) {
                appendLog('Cannot open browser: Server is not running');
                return;
            }
            appendLog('Opening browser...');
            ipcRenderer.send('open:browser');
        });

        document.getElementById('openLogs').addEventListener('click', () => {
            appendLog('Opening logs folder...');
            ipcRenderer.send('open:logs');
        });

        document.getElementById('checkNetwork').addEventListener('click', () => {
            appendLog('Checking network connectivity...');
            ipcRenderer.send('check:network');
            networkStatus.textContent = 'Checking network...';
            networkStatus.className = 'network-status';
        });

        document.getElementById('saveSystemLogs').addEventListener('click', () => {
            appendLog('Saving system logs...');
            ipcRenderer.send('save:systemLogs', log.textContent);
        });

        // IPC handlers
        ipcRenderer.on('server:started', () => {
            serverStatus.textContent = 'Server is running';
            serverStatus.style.color = '#4CAF50';
            appendLog('Server started successfully');
            // Enable stop, restart, and browser buttons
            stopServerBtn.disabled = false;
            restartServerBtn.disabled = false;
            openBrowserBtn.disabled = false;
            serverRunning = true;
        });

        ipcRenderer.on('server:stopped', () => {
            serverStatus.textContent = 'Server is stopped';
            serverStatus.style.color = '#f44336';
            appendLog('Server stopped');
            // Disable stop, restart, and browser buttons
            stopServerBtn.disabled = true;
            restartServerBtn.disabled = true;
            openBrowserBtn.disabled = true;
            serverRunning = false;
        });

        ipcRenderer.on('server:log', (event, message) => {
            appendLog(message);
        });

        ipcRenderer.on('network:status', (event, { connected, latency }) => {
            if (connected) {
                networkStatus.textContent = `Connected to Internet (${latency}ms)`;
                networkStatus.className = 'network-status network-connected';
                appendLog(`Network connection successful (${latency}ms)`);
            } else {
                networkStatus.textContent = 'No Internet Connection';
                networkStatus.className = 'network-status network-disconnected';
                appendLog('Network connection failed');
            }
        });

        ipcRenderer.on('update:status', (event, message) => {
            updateStatus.textContent = message;
            appendLog(message);
        });

        ipcRenderer.on('logs:saved', (event, path) => {
            appendLog(`Logs saved to: ${path}`);
        });

        // Initial log and checks
        appendLog('Application started');
        
        // Check for updates on startup
        setTimeout(() => {
            appendLog('Performing initial update check...');
            ipcRenderer.send('check:update');
        }, 2000);

        // Automatic network check on startup
        window.addEventListener('load', () => {
            setTimeout(() => {
                ipcRenderer.send('check:network');
            }, 1000);
        });

        // Add these after the existing script content
        const modals = {
            instructions: document.getElementById('instructionsModal'),
            about: document.getElementById('aboutModal'),
            developers: document.getElementById('developersModal')
        };

        // IPC handlers for showing modals
        ipcRenderer.on('show:instructions', () => {
            appendLog('Opening Instructions...');
            modals.instructions.style.display = 'block';
        });

        ipcRenderer.on('show:about', () => {
            appendLog('Opening About...');
            modals.about.style.display = 'block';
        });

        ipcRenderer.on('show:developers', () => {
            appendLog('Opening Developers...');
            modals.developers.style.display = 'block';
        });

        // Close button handling for all modals
        document.querySelectorAll('.close').forEach(closeBtn => {
            closeBtn.onclick = function() {
                this.closest('.modal').style.display = 'none';
                appendLog('Closed modal');
            }
        });

        // Close modal when clicking outside
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
                appendLog('Closed modal');
            }
        }

        // Report Problem functionality
        const reportModal = document.getElementById('reportModal');
        const reportBtn = document.getElementById('reportProblem');
        const reportForm = document.getElementById('reportForm');
        const imageAttachment = document.getElementById('imageAttachment');
        const imagePreview = document.getElementById('imagePreview');

        reportBtn.addEventListener('click', () => {
            appendLog('Opening Report Problem form...');
            reportModal.style.display = 'block';
        });

        imageAttachment.addEventListener('change', (e) => {
            imagePreview.innerHTML = '';
            imagePreview.style.display = 'block';
            
            [...e.target.files].forEach(file => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const img = document.createElement('img');
                    img.src = e.target.result;
                    img.style.maxWidth = '200px';
                    img.style.marginRight = '10px';
                    img.style.marginBottom = '10px';
                    imagePreview.appendChild(img);
                };
                reader.readAsDataURL(file);
            });
        });

        reportForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            appendLog('Submitting problem report...');

            // Disable submit button and show loading state
            const submitBtn = reportForm.querySelector('.submit-report');
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Sending...';

            try {
                // Process images first
                const imagePromises = [...imageAttachment.files].map(file => {
                    return new Promise((resolve) => {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            resolve({
                                name: file.name,
                                data: e.target.result
                            });
                        };
                        reader.readAsDataURL(file);
                    });
                });

                const processedImages = await Promise.all(imagePromises);

                const formData = {
                    category: document.getElementById('problemCategory').value,
                    title: document.getElementById('problemTitle').value,
                    description: document.getElementById('problemDescription').value,
                    systemLogs: log.textContent,
                    images: processedImages
                };

                ipcRenderer.send('submit:report', formData);
            } catch (error) {
                appendLog(`Error processing form data: ${error.message}`);
                submitBtn.disabled = false;
                submitBtn.innerHTML = '<i class="fas fa-paper-plane"></i> Submit Report';
            }
        });

        // Add handlers for report submission response
        ipcRenderer.on('report:sent', (event, message) => {
            appendLog('Problem report sent successfully');
            const submitBtn = reportForm.querySelector('.submit-report');
            submitBtn.innerHTML = '<i class="fas fa-check"></i> Sent!';
            setTimeout(() => {
                reportModal.style.display = 'none';
                reportForm.reset();
                imagePreview.style.display = 'none';
                imagePreview.innerHTML = '';
                submitBtn.disabled = false;
                submitBtn.innerHTML = '<i class="fas fa-paper-plane"></i> Submit Report';
            }, 2000);
        });

        ipcRenderer.on('report:error', (event, error) => {
            appendLog(`Error sending report: ${error}`);
            const submitBtn = reportForm.querySelector('.submit-report');
            submitBtn.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Failed to Send';
            submitBtn.style.backgroundColor = '#f44336';
            
            // Show error message to user
            const errorDiv = document.createElement('div');
            errorDiv.style.color = '#f44336';
            errorDiv.style.marginTop = '10px';
            errorDiv.style.fontSize = '14px';
            errorDiv.innerHTML = `<i class="fas fa-exclamation-circle"></i> ${error}`;
            
            const existingError = reportForm.querySelector('.error-message');
            if (existingError) {
                existingError.remove();
            }
            errorDiv.className = 'error-message';
            reportForm.appendChild(errorDiv);

            // Reset button after 3 seconds
            setTimeout(() => {
                submitBtn.disabled = false;
                submitBtn.innerHTML = '<i class="fas fa-paper-plane"></i> Submit Report';
                submitBtn.style.backgroundColor = '#E91E63';
            }, 3000);
        });

        // Add update modal handling
        const updateModal = document.getElementById('updateModal');
        const updateTitle = document.getElementById('updateTitle');
        const updateDescription = document.getElementById('updateDescription');
        const releaseDate = document.getElementById('releaseDate');
        const updateVersion = document.getElementById('updateVersion');
        const releaseNotes = document.getElementById('releaseNotes').querySelector('pre');
        const updateProgress = document.getElementById('updateProgress');
        const progressBar = document.querySelector('.progress-bar');
        const progressText = document.getElementById('progressText');
        const updateError = document.getElementById('updateError');
        const postponeUpdate = document.getElementById('postponeUpdate');
        const downloadUpdate = document.getElementById('downloadUpdate');

        // Handle update available
        ipcRenderer.on('update:available', (event, updateInfo) => {
            updateTitle.textContent = updateInfo.releaseName;
            updateDescription.textContent = 'A new version of J5 Pharmacy Management System is available.';
            releaseDate.textContent = updateInfo.releaseDate;
            updateVersion.textContent = `v${updateInfo.latestVersion}`;
            releaseNotes.textContent = updateInfo.releaseNotes;
            updateModal.style.display = 'block';
            updateProgress.style.display = 'none';
            updateError.style.display = 'none';

            // Check if download URL is available
            if (!updateInfo.downloadUrl) {
                updateError.textContent = 'Update package is not available yet. Please try again later.';
                updateError.style.display = 'block';
                downloadUpdate.disabled = true;
            } else {
                downloadUpdate.disabled = false;
            }
        });

        // Handle critical updates
        ipcRenderer.on('update:critical', (event, updateInfo) => {
            updateTitle.textContent = 'Critical Update Required';
            updateDescription.textContent = updateInfo.reason;
            releaseDate.textContent = updateInfo.releaseDate;
            updateVersion.textContent = `v${updateInfo.latestVersion}`;
            releaseNotes.textContent = updateInfo.releaseNotes;
            updateModal.style.display = 'block';
            postponeUpdate.style.display = 'none';
            updateProgress.style.display = 'none';
            updateError.style.display = 'none';
        });

        // Handle download progress
        ipcRenderer.on('update:download-progress', (event, progress) => {
            updateProgress.style.display = 'block';
            progressBar.style.width = `${progress}%`;
            progressText.textContent = `Downloading: ${Math.round(progress)}%`;
            downloadUpdate.disabled = true;
            postponeUpdate.disabled = true;
        });

        // Handle download error
        ipcRenderer.on('update:download-error', (event, error) => {
            updateError.textContent = `Download failed: ${error}`;
            updateError.style.display = 'block';
            updateProgress.style.display = 'none';
            downloadUpdate.disabled = false;
            postponeUpdate.disabled = false;
        });

        // Handle install error
        ipcRenderer.on('update:install-error', (event, error) => {
            updateError.textContent = `Installation failed: ${error}`;
            updateError.style.display = 'block';
            updateProgress.style.display = 'none';
            downloadUpdate.disabled = false;
            postponeUpdate.disabled = false;
        });

        // Handle download button click
        downloadUpdate.addEventListener('click', () => {
            ipcRenderer.send('update:download');
            downloadUpdate.disabled = true;
            postponeUpdate.disabled = true;
        });

        // Handle postpone button click
        postponeUpdate.addEventListener('click', () => {
            ipcRenderer.send('update:postpone');
            updateModal.style.display = 'none';
        });

        // Theme toggle functionality
        const themeToggle = document.getElementById('themeToggle');
        const sunIcon = document.querySelector('.sun-icon');
        const moonIcon = document.querySelector('.moon-icon');
        
        // Load saved theme
        const savedTheme = localStorage.getItem('theme') || 'light';
        document.documentElement.setAttribute('data-theme', savedTheme);
        updateThemeIcon(savedTheme);

        themeToggle.addEventListener('click', () => {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            updateThemeIcon(newTheme);
        });

        function updateThemeIcon(theme) {
            if (theme === 'dark') {
                sunIcon.style.display = 'none';
                moonIcon.style.display = 'block';
            } else {
                sunIcon.style.display = 'block';
                moonIcon.style.display = 'none';
            }
        }

        // Time and date update
        function updateDateTime() {
            const now = new Date();
            const timeElement = document.getElementById('time');
            const dateElement = document.getElementById('date');
            
            timeElement.textContent = now.toLocaleTimeString();
            dateElement.textContent = now.toLocaleDateString();
        }

        updateDateTime();
        setInterval(updateDateTime, 1000);

        // Get version for About modal
        const { remote } = require('electron');
        const app = remote ? remote.app : require('@electron/remote').app;
        const version = app.getVersion();

        // Update About modal content when it's opened
        document.addEventListener('DOMContentLoaded', () => {
            const aboutVersion = document.getElementById('aboutVersion');
            if (aboutVersion) {
                aboutVersion.textContent = version;
            }
        });
    </script>
</body>
</html> 